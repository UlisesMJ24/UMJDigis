<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
    <head>
        <title>Lista de Usuarios</title>
    </head>
    <body class="container-fluid">

        <div class="container my-5" layout:fragment="contenido">

            <div class="container text-center">
                <div class="row">
                    <div class="col">
                        <h1 class="text-primary">
                            <i class="bi bi-people-fill me-2"></i>Lista de Usuarios
                        </h1>
                    </div>
                    <div class="col">
                        <a class="btn btn-success btn-lg shadow me-2" th:href="@{/Usuario/add}">
                            <i class="bi bi-person-plus-fill me-2"></i>Agregar Nuevo Usuario
                        </a>
                    </div>
                    <div class="col">
                        <a class="btn btn-primary btn-lg shadow" th:href="@{/Usuario/CargaMasiva}">
                            <i class="bi bi-download me-2"></i>Super Carga
                        </a>
                    </div>
                </div>
            </div>

            <hr>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light text-primary">
                    <i class="bi bi-funnel-fill me-2"></i>Filtros de Búsqueda
                </div>
                <div class="card-body">
                    <form method="post" th:action="@{/Usuario/GetAll}" th:object="${usuarioBusqueda}" class="row g-3 align-items-end">

                        <div class="col-md-3 col-sm-6">
                            <label for="pNombreUsuario" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="pNombreUsuario" th:field="*{Nombre}" placeholder="Buscar por nombre">
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <label for="pApellidoPaterno" class="form-label">Apellido Paterno</label>
                            <input type="text" class="form-control" id="pApellidoPaterno" th:field="*{ApellidoPaterno}" placeholder="Buscar por Ap. Paterno">
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <label for="pApellidoMaterno" class="form-label">Apellido Materno</label>
                            <input type="text" class="form-control" id="pApellidoMaterno" th:field="*{ApellidoMaterno}" placeholder="Buscar por Ap. Materno">
                        </div>

                        <div class="col-md-3 col-sm-6">
                            <label for="pNombreRol" class="form-label">Rol</label>
                            <select class="form-control" id="pNombreRol" th:field="*{Rol.idRol}">
                                <option value="0" selected>-- Todos los Roles --</option>
                                <option th:each="rol : ${roles}" th:value="${rol.idRol}" th:text="${rol.nombre}"></option>
                            </select>
                        </div>



                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary shadow">
                                <i class="bi bi-search me-2"></i>Buscar
                            </button>
                        </div>
                    </form>
                </div>


                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle shadow-sm">
                        <thead class="table-dark">
                            <tr> 
                                <th scope="col">Imagen</th>
                                <th scope="col">Usuario</th>
                                <th scope="col">Información de Contacto</th>
                                <th scope="col">Dirección</th>
                                <th scope="col" class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="usuario, usuarioStat : ${usuarios}">

                                <td>
                                    <div class="text-center my-4">
                                        <div class="d-inline-block border rounded-circle p-1 shadow-sm" style="background-color: #f8f9fa;">
                                            <img th:src="${usuario.Imagen != null and usuario.Imagen.length() > 0} ? 
                                                 'data:image/jpeg;base64,' + ${usuario.Imagen} : 
                                                 'https://via.placeholder.com/110?text=No+Foto'"
                                                 alt="Foto del usuario"
                                                 class="rounded-circle img-fluid"
                                                 style="width: 110px; height: 110px; object-fit: cover;">
                                        </div>
                                        <h5 class="mt-3 text-secondary" th:text="${usuario.Nombre}">Nombre del Usuario</h5>
                                    </div>
                                </td>

                                <td>
                                    <div><strong th:text="${usuario.UserName}"></strong></div>
                                    <small class="text-muted" th:text="|Nombre: ${usuario.Nombre} ${usuario.ApellidoPaterno} ${usuario.ApellidoMaterno}|"></small>
                                </td>

                                <td>
                                    <div><i class="bi bi-telephone-fill me-1"></i> Teléfono: <span th:text="${usuario.Telefono}"></span></div>
                                    <div><i class="bi bi-phone-fill me-1"></i> Celular: <span th:text="${usuario.Celular}"></span></div>
                                </td>

                                <td>
                                    <div th:each="direccion : ${usuario.Direcciones}" class="mb-3">
                                        <div class="fw-bold">
                                            <span th:text="${direccion.Calle}">Calle</span> 
                                            <span th:utext="'Int: <b>' + ${direccion.NumeroInterior} + '</b> Ext: <b>' + ${direccion.NumeroExterior} + '</b>'"></span>
                                        </div>
                                        <small class="text-muted">
                                            Colonia: <span th:text="${direccion.colonia.Nombre}">Colonia</span><br>
                                            Mpo/Edo: 
                                            <span th:text="${direccion.colonia.municipio.Nombre}">Municipio</span>, 
                                            <span th:text="${direccion.colonia.municipio.estado.Nombre}">Estado</span><br>
                                            País: <span th:text="${direccion.colonia.municipio.estado.pais.Nombre}">País</span>
                                        </small>
                                    </div>
                                </td>

                                <td>
                                    <div class="d-grid gap-2 d-md-block text-center">
                                        <a class="btn btn-warning btn-sm" th:href="@{/Usuario/detail/{idUsuario}(idUsuario=${usuario.IdUsuario})}">
                                            <i class="bi bi-eye-fill me-1"></i> Vizualizar
                                        </a>
                                        <button class="btn btn-danger btn-sm" type="button" disabled>
                                            <i class="bi bi-trash-fill me-1"></i> Eliminar
                                        </button>
                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    </body>
</html>